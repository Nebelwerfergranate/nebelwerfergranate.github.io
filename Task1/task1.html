<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8" />
		<title>Заголовок</title>
		
		<!-- подключаем mocha -->
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.1.0/mocha.css">
	    <link rel="stylesheet" href="style.css">
	 	<script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/2.1.0/mocha.js"></script>
		<script>
			mocha.setup('bdd'); // настраиваем Mocha на BDD-тестирование
	 	</script>
	
	  	<!-- подключаем chai -->
	  	<script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js"></script>
	  	<script>
	    	var assert = chai.assert; // выносим assert в глобальную область
	  	</script>
	  	
	  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	</head>
	<body>
		<div class="container">
			<h1>Пузырьковая сортировка</h1>
			<div id="screen"></div>
			<div id="inputPanel">
				<h2>Создайте массив</h2>
				<input id="inputField" type="number" min="-999" max="999" step="1" value="0" required/>
				<button id="addNumberBtn" class="btn">Добавить число (enter)</button>
				<button id="startBtn" class="btn">Начать сортировку</button>
				<button id="randomBtn" class="btn">Для ленивых</button>
			</div>
			<div id="sortPanel" class="hidden">
				<h2>Выполнение сортировки</h2>
				<button id="nextStepBtn" class="btn">Следующий шаг (enter)</button>
				<button id="resetBtn" class="btn">Сброс</button>
			</div>
			
			<!-- в элементе с id="mocha" будут результаты тестов -->
  			<div id="mocha"></div>
		</div>
		
			<!-- в элементе с id="mocha" будут результаты тестов -->
  			<div id="mocha"></div>
		</div>
		
		
		<!-- Скрипты -->
		<script type="text/javascript" src="sorter.js"></script>
		<script type="text/javascript" src="utils.js"></script>
		
  		<script src="test.js"></script>
  		<script>
  			mocha.run();
  		</script>
		
		<script>
			$().ready(function(){
	            var data = [];
	           	var sorter = null;
	           	var sortingIsRunning = false;
	           	
	           	var getRandomInt = Utils.getRandomInt;
	           	
	           	$("#inputField").select();
	           
	            $("#addNumberBtn").on("click", function() {
	            	var input = document.getElementById("inputField");
	            	if(!input.checkValidity()){
	            		return;
	            	}
	               	data.push(parseInt(input.value));
	                input.value = 0;
	                input.select();
	                render(data);
	            })
	            
	            $(document).keydown(function(e) {
	            	if(e.keyCode == 13){
	            		if(sortingIsRunning){
	            			$("#nextStepBtn").click();
	            		}else{
	            			$("#addNumberBtn").click();	
	            		}
	            	}
				});
	            
	            $("#startBtn").on("click", function() {
	            	if(data.length < 2){
	            		return;
	            	}
	                $("#inputPanel").addClass("hidden");
	                $("#sortPanel").removeClass("hidden");
	                sortingIsRunning = true;
	                sorter = new Sorter(data);
	            });
	            
	            $("#randomBtn").on("click", function(){
	            	var capacity = 10;
			        for(var i = 0; i < capacity; i ++){
			            data.push(getRandomInt(-999, 999));
			        }
			        $("#startBtn").click();
			        render(data);
	            });
	            
	            
	            $("#nextStepBtn").on("click", function(){
	            	sorter.nextStep();
	            	
	            	render(sorter.data);
		           	
		           	if(sorter.isChanged){
		           		$("#screen p").eq(sorter.position).addClass("red");
		            	$("#screen p").eq(sorter.position + 1).addClass("red");
		           	} else{
		           		$("#screen p").eq(sorter.position).addClass("yellow");
		            	$("#screen p").eq(sorter.position + 1).addClass("yellow");	
		           	}
	            });
	            
	            $("#resetBtn").on("click", function(){
	            	sortingIsRunning = false;
	            	sorter = null;
	            	data = [];
	            	render(data);
	            	$("#inputPanel").removeClass("hidden");
	                $("#sortPanel").addClass("hidden");
	            })
	            
	            function render(data){
	            	$("#screen").html("");
	            	for(var i = 0; i < data.length; i++){
		           		$("#screen").append( "<p>" + data[i] + "</p>" );
		           	}
	            }
            });
		</script>
	</body>
</html>